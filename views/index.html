<!doctype html><html lang=en><head><title>SG HDB Building Layer in MapBox WebGL</title><meta charset=utf-8><meta name=viewport content="initial-scale=1,maximum-scale=1,user-scalable=no"><link href=css/mapbox-gl.css rel=stylesheet><script src=js/mapbox-gl.js></script><script src=data/hdb_only.js></script><script src=data/hdb_building_polygons.js></script><style>body{margin:0;padding:0}#map{position:absolute;top:0;bottom:0;width:100%}table,td,th,tr{border-collapse:collapse;text-align:left}</style></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id=map></div><script>function getBuildingColor(a){var t=(a=(feature=features[f]).properties).RESIDENTIAL,e=a.COMMERCIAL,o=a.MARKET_HAWKER,r=a.MULTISTOREY_CARPARK,l=a.PRECINCT_PAVILION;a.MISCELLANEOUS;return"Y"==t&&"Y"==e?"#34aee4":"Y"==e&&"N"==t?"#255294":"N"==e&&"Y"==t?"#f0c087":"Y"==o?"#e58380":"Y"==r?"#96999a":"Y"==l?"#acb10e":"#fcf66c"}var f,features=hdb_building_polygons.features;for(f in features){let a=getBuildingColor(features[f].properties);hdb_building_polygons.features[f].properties.color=a}function jsonObjToHTMLTable(a){let t="";var e=a.BLK_NO+" "+a.STREET+" S("+a.POSTAL+")",o=a.BUILDING;return t+="<div>",t+="<h4>📍&nbsp;"+e+"</h4><h5><span style='color:"+getBuildingColor(a)+"'>◼</span> "+o+"</h5>",t+="<table>","Y"==a.RESIDENTIAL&&(t+="<tr>",t+="<th>🏠</th>",t+="<td><small>Residential</small></td>",t+="</tr>"),"Y"==a.COMMERCIAL&&(t+="<tr>",t+="<th>🏪</th>",t+="<td><small>Commerical</small></td>",t+="</tr>"),"Y"==a.MARKET_HAWKER&&(t+="<tr>",t+="<th>🍴</th>",t+="<td><small>Market/Hawker Centre</small></td>",t+="</tr>"),"Y"==a.MULTISTOREY_CARPARK&&(t+="<tr>",t+="<th>🚏🚗</th>",t+="<td><small>Multi-Storey Carpark</small></td>",t+="</tr>"),"Y"==a.PRECINCT_PAVILION&&(t+="<tr>",t+="<th>🏡</th>",t+="<td><small>Precint Pavilion</small></td>",t+="</tr>"),(a="Y"==a.MISCELLANEOUS)&&(t+="<tr>",t+="<th>🏢</th>",t+="<td><small>Miscellanous✶</small></td>",t+="</tr>",t+="<tr>",t+='<td colspan="2"><hr><small>✶(E.g. admin office, childcare centre, education centre)</small></td>',t+="</tr>"),t+="</table>",t+="<hr><p style='text-align:right'><small><a href='https://www.buymeacoffee.com/geekcc' target='_blank'>☕ Buy me a coffee!</a></small></p></div>"}for(f in features=hdb_only.features){var feature,featureProps=(feature=features[f]).properties;hdb_only.features[f].properties.description=jsonObjToHTMLTable(featureProps),hdb_only.features[f].properties.icon="dot_annotation"}const southWest=[1.22557,103.67592],northEast=[1.4267,104.02542];mapboxgl.accessToken="pk.eyJ1IjoiZ2Vlay1jYyIsImEiOiJja3VnZW42cTEyM2RiMm5temVnNjdvOHIyIn0.8-BhfDwt5IfVfXpGaSAtGA";const mapboxMap=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/light-v10",center:[parseFloat((southWest[1]+northEast[1])/2),parseFloat((southWest[0]+northEast[0])/2)],zoom:14.95,pitch:45,bearing:-17.6,antialias:!0});mapboxMap.on("load",()=>{mapboxMap.loadImage("img/invisible_dot.png",(a,t)=>{if(a)throw a;mapboxMap.addImage("dot_annotation",t),mapboxMap.addSource("places",{type:"geojson",data:hdb_only}),mapboxMap.addLayer({id:"places",type:"symbol",source:"places",layout:{"icon-image":"{icon}","icon-allow-overlap":!0}}),mapboxMap.addSource("hdb_blks",{type:"geojson",data:hdb_building_polygons}),mapboxMap.addLayer({id:"hdb-extrusion",type:"fill-extrusion",source:"hdb_blks",paint:{"fill-extrusion-color":["get","color"],"fill-extrusion-height":["get","MAX_STOREY"],"fill-extrusion-opacity":.95}}),mapboxMap.on("click","places",a=>{const t=a.features[0].geometry.coordinates.slice();for(var e=a.features[0].properties.description;180<Math.abs(a.lngLat.lng-t[0]);)t[0]+=a.lngLat.lng>t[0]?360:-360;(new mapboxgl.Popup).setLngLat(t).setHTML(e).addTo(mapboxMap)}),mapboxMap.on("mouseenter","places",()=>{mapboxMap.getCanvas().style.cursor="pointer"}),mapboxMap.on("mouseleave","places",()=>{mapboxMap.getCanvas().style.cursor=""})}),mapboxMap.addControl(new mapboxgl.NavigationControl)});</script></body></html>